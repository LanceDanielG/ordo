<div class="app-layout">
    <app-sidebar></app-sidebar>

    <main class="main-content">
        <header class="dashboard-header h-animate">
            <div class="header-left">
                <h1 class="text-3xl font-black gradient-text">
                    {{ projectStore.selectedProject()?.name || 'My Tasks' }}
                </h1>
                <p class="text-slate-500 font-medium">
                    {{ projectStore.selectedProject()?.description || 'Manage your work with precision' }}
                </p>
            </div>
            
            <div class="header-right">
                <!-- User Avatars/Team -->
                <div class="team-avatars">
                    <div class="avatar glass" *ngFor="let member of projectStore.currentMembers().slice(0, 3)" [title]="member.profiles.full_name || member.profiles.email">
                        {{ (member.profiles.full_name || member.profiles.email).charAt(0).toUpperCase() }}
                    </div>
                    <button class="add-member-btn glass" *ngIf="projectStore.selectedProject()" (click)="toggleMemberManager()">
                        <span class="material-icons">person_add</span>
                    </button>
                    
                    <!-- Member Manager Modal Overlay -->
                    <div class="modal-overlay" *ngIf="showMemberManager()" (click)="toggleMemberManager()">
                        <app-member-management (click)="$event.stopPropagation()" (onClose)="toggleMemberManager()"></app-member-management>
                    </div>
                </div>

                <div class="view-controls glass">
                    <button class="control-btn" [class.active]="viewMode() === 'board'" (click)="setViewMode('board')" title="Board View">
                        <span class="material-icons">view_kanban</span>
                    </button>
                    <button class="control-btn" [class.active]="viewMode() === 'list'" (click)="setViewMode('list')" title="List View">
                        <span class="material-icons">format_list_bulleted</span>
                    </button>
                </div>
                
                <button 
                (click)="theme.toggleTheme()" 
                class="theme-toggle glass"
                [class.dark]="theme.isDarkMode()">
                <div class="toggle-track">
                    <span class="material-icons sun">light_mode</span>
                    <span class="material-icons moon">dark_mode</span>
                    <div class="toggle-thumb"></div>
                </div>
            </button>
            </div>
        </header>

        <section class="quick-input-section h-animate" style="animation-delay: 0.1s;">
            <app-todo-input></app-todo-input>
        </section>

        <!-- Views Area -->
        <div class="board-viewport h-animate" style="animation-delay: 0.2s;" *ngIf="viewMode() === 'board'">
            <div class="kanban-wrapper" cdkDropListGroup>
                <!-- To Do Column -->
                <div class="kanban-column glass-panel">
                    <div class="column-header">
                        <div class="header-title">
                            <span class="count">{{ todoStore.todoList().length }}</span>
                            <h3>Todo</h3>
                        </div>
                        <button class="more-btn" (click)="clearColumn('todo')">
                            <span class="material-icons">delete_sweep</span>
                        </button>
                    </div>
                    <app-todo-list category="todo"></app-todo-list>
                </div>

                <!-- In Progress Column -->
                <div class="kanban-column glass-panel">
                    <div class="column-header">
                        <div class="header-title">
                            <span class="count in-progress">{{ todoStore.inProgressList().length }}</span>
                            <h3>In Progress</h3>
                        </div>
                        <button class="more-btn" (click)="clearColumn('in-progress')">
                            <span class="material-icons">delete_sweep</span>
                        </button>
                    </div>
                    <app-todo-list category="in-progress"></app-todo-list>
                </div>

                <!-- Done Column -->
                <div class="kanban-column glass-panel">
                    <div class="column-header">
                        <div class="header-title">
                            <span class="count done">{{ todoStore.doneList().length }}</span>
                            <h3>Done</h3>
                        </div>
                        <button class="more-btn" (click)="clearColumn('done')">
                            <span class="material-icons">delete_sweep</span>
                        </button>
                    </div>
                    <app-todo-list category="done"></app-todo-list>
                </div>

                <!-- Add Column Placeholder -->
                <div class="kanban-column add-column" (click)="addColumn()">
                    <button class="add-column-btn">
                        <span class="material-icons">add</span>
                        <span>Add Column</span>
                    </button>
                </div>
            </div>
        </div>
        <!-- List View Area -->
        <div class="list-viewport h-animate" style="animation-delay: 0.2s;" *ngIf="viewMode() === 'list'">
            <div class="container mx-auto">
                <div class="glass-panel p-6">
                    <app-todo-list category="todo"></app-todo-list>
                    <app-todo-list category="in-progress"></app-todo-list>
                    <app-todo-list category="done"></app-todo-list>
                </div>
            </div>
        </div>
    </main>

    <app-toast></app-toast>
</div>
